/**
 * This ruleset governs access to the Firestore database for a token trading application.
 *
 * Core Philosophy:
 * The security model is designed to treat token data as public, read-only information for all clients.
 * This allows any user, authenticated or not, to view real-time token prices, volumes, and other market data.
 * To protect data integrity, all client-side write operations (create, update, delete) are explicitly forbidden.
 * Data updates are expected to be performed by a trusted backend service or administrative process, not directly by end-users.
 *
 * Data Structure:
 * The data is organized into a single, top-level collection:
 * - /tokens/{tokenId}: Stores all public information about a specific trading token.
 *
 * Key Security Decisions:
 * - Public Read Access: The `/tokens` collection is publicly readable to support the primary function of displaying market data to all users without requiring them to sign in.
 * - Client-Side Writes Disabled: To prevent malicious or accidental data corruption, no client is permitted to create, update, or delete token documents. This enforces the principle that public data integrity must be maintained by a secure, server-side process.
 * - No User-Specific Data: The ruleset assumes there is no user-owned or private data within the defined collections.
 *
 * Denormalization for Authorization:
 * This principle is not applicable to this ruleset as there are no user-specific authorization checks. All data is treated as public.
 *
 * Structural Segregation:
 * This principle is not applicable as all data is public and of a single type, so there is no need to segregate public from private content.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access for all token data but denies all client-side writes to maintain data integrity.
     * @path        /tokens/{tokenId}
     * @allow       Any user, signed-in or anonymous, can read a token document. (e.g., `db.collection('tokens').doc('BTC').get()`).
     * @deny        Any user attempting to update a token's price is denied. (e.g., `db.collection('tokens').doc('BTC').update({ price: ... })`).
     * @principle   Protects public data integrity by making it read-only for clients. Updates must be handled by a trusted backend environment.
     */
    match /tokens/{tokenId} {
      allow get: if true;
      allow list: if true;

      // Writes are disabled. Token data should only be updated by a trusted backend service
      // to ensure data integrity and prevent market manipulation.
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }
  }
}